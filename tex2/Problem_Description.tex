\chapter{Problem Description and Classification}

In this chapter, the problem is stated in detail and the notation is introduced. The problem is classified by relating it to known problems in literature and its complexity is determined. Finally, known approaches to similar problems are regarded. Most of the following considerations are already part of the underlying theses \cite{Kaiser_Knoll}, except for the fact that multiple leg is allowed. For better clarity to the reader, all crucial results are repeated here.

\section{Situation and Issue}

We regard the situation of free-floating car sharing as it exists today in combination with autonomous vehicles. Free-floating car sharing means that a costumer can rent an available car wherever and whenever there is one and use it as long as he needs it. After usage, he parks the car somewhere in the operation area. We assume the existence of autonomous vehicles. An autonomous vehicle behaves the same as if a human being drives it, but without that a human being is necessarily present. Instead of looking for a car, a costumer books a car via a smartphone application and gets picked up by the car at the desired start location and at the desired start time. For the costumer, this seems similar to a taxi service. 

The car sharing issue is combined with public transport as it is known today. There is a fixed schedule, according to which the bus or train visits public transport stations in a row at certain time points. A possible route for a costumer may look as follows: The costumer is picked up at his start position by a car and is brought to a station where he gets on a train. After finishing the train trip, he is picked up again by another car and is brought to his destination. It is also possible to change trains during this public transport trip. This behavior is very advantageous for the costumer. While an in-between train trip is cheaper than a pure car trip, the combination of car and train is faster than a pure public transport trip since does not have walking and changing time.

%----------------------------------------------------------------------------------------------------------------------------------------

\section{Problem Description and Notation}
\label{sec:problem_description}

In order to realize the previously described problem, we introduce a formal notation for the problem. We have a set of costumers with known travel requests. Each of those can be realized by a number of precomputed multimodal routes. Each route consists of a sequence of trips. A trip is either a car trip or a public transport trip and has a fixed start and end position, as well as a fixed start and end time. Fulfilling a route means that the costumer takes all the trips of this route in a row, \ie he starts at the start point of the first trip and is finished at the end point of the last trip. The transition between two subsequent trips is the changing from a car to a train or the other way round. Each costumer has to be satisfied, \ie he has to be able to fulfill one of his alternative routes.

Although we formally define public transport trips here, we regard only the car trips in detail. Public transport is maintained by an own schedule and is not of interest for this issue. The availability of suitable public transport trips has to be respected while creating the routes (Chapter \ref{ch:instance_creation}). There, the car trips are created in such a way that they are suitable to the existing public transport trips. Here, we assume the existence of feasible routes and therefore only control the behavior of the cars.

For fulfilling the car trips, we have a set of vehicles. For each vehicle, we have a position where it starts and a time from when it is available. A vehicle can drive from its start point to a trip's start point, execute this trip, and then drive from the trip's end point to the next trip's start point. After fulfilling its last trip, the car stays at the end point of the last trip. The sequence, in which the vehicle executes the trips, is called the duty of the vehicle. 

A further restriction to the problem is that the vehicles have a maximal range that they can drive without refueling. In the model, refueling points are included.

The objective is to create a schedule for the vehicles, such that for each costumer exactly one route is fulfilled, \ie every trip of this route is fulfilled. Further, each vehicle has a feasible fuel state all the time and visits a refuel station when necessary.

\paragraph{Costumers, Trips and Vehicles} \parfill

We are given a set of car trips $\mathcal{T}$. Each trip $t\in\mathcal{T}$ has a start and end location $\pstart_t, \pend_t$ and a start and end time $\zstart_t, \zend_t$. For the sake of completeness, we define the set of public transport trips $\Tpub$ with the same properties for $t\in\Tpub$.

The set of vehicles is denoted by $\mathcal{V}$. The start position and the start time of a vehicle $v\in\mathcal{V}$ is $p_v$ and $z_v$.

We have the set of costumers $\mathcal{C}$ and the set of multimodal routes $\mathcal{M}$. A route $m=\left(t_1,\dots,t_{k_m}\right)$ is a finite sequence of trips with the following properties:
\begin{align*}
	\pend_{t_i} = \pstart_{t_{i+1}} && \zend_{t_i} \leq \zstart_{t_{i+1}} && \text{for all } i\in[k-1].
\end{align*}

We define the route start and end locations and times for $m\in\mathcal{M}$ as
\begin{align*}
	\pstart_m := \pstart_{t_1} & &  \pend_m := \pend_{t_k} & & \zstart_m := \zstart_{t_1} & & \zend_m := \zend_{t_k}.
\end{align*}

The mapping $M:\mathcal{T}\to\mathcal{M}$ indicates to which route a trip belongs. Each costumer $c\in\mathcal{C}$ has a finite set of alternative routes. The mapping $C:\mathcal{M}\to\mathcal{C}$ shows which route belongs to which costumer.

We use the notation
\begin{align*}
	C^{-1}(c) & := C^{-1}\left(\{c\}\right) = \left\{m\in\mathcal{M}\mid C(m)=c\right\} && \text{for } c\in\mathcal{C} \\
	M^{-1}(m) & := M^{-1}\left(\{m\}\right) = \left\{t\in\mathcal{T}\mid M(t)=m\right\} && \text{for } m\in\mathcal{M} \\
	\left(M\circ C\right)^{-1}(c) & := M^{-1}\left(C^{-1}(c)\right) = \left\{t\in\mathcal{T}\mid C\left(M(t)\right)=c\right\} && \text{for } c\in\mathcal{C}
\end{align*}

for all routes of a costumer, all trips of a route and all trips of a costumer, respectively.

For each route of the same costumer $m\in C^{-1}(c)$, the start and end positions are the same, the start and end times may differ. We define the costumer start and end times for $c\in\mathcal{C}$
\begin{align*}
	\zstart_c := \min_{m\in C^{-1}(c)}\zstart_m & & \zend_c := \max_{m\in C^{-1}(c)}\zend_m .
\end{align*}

\paragraph{Fuel and Refueling} \parfill

We have to consider fuel restrictions. Fuel can be any form of energy the considered vehicle is powered with. For each vehicle, the fuel level is in the interval $[0,1]$, where $1$ means full capacity and $0$ is empty. We call a trip without a costumer, \ie a trip between two trips, a deadhead trip. A car may visit a refuel station only during a deadhead trip. For simplicity of the model, each car is allowed to refuel at most once between two trips. On a refuel station, there are no capacity constraints, \ie two or more vehicles may refuel at the same time on the same station.

For refueling, we have a set of refuel stations $\mathcal{R}$. A refuel station $r\in\mathcal{R}$ has a location $p_r$. We define $\fd_{s,t}$ for $s\in\mathcal{V}\cupdot\mathcal{T}\cupdot\mathcal{R}$, $t\in\mathcal{T}\cupdot\mathcal{R}$ as the amount, the fuel level decreases along a deadhead trip. $\ft_t$ for $t\in\mathcal{T}\cupdot\mathcal{R}$ is the amount of fuel, a vehicle needs for a trip. For $r\in\mathcal{R}$ holds $\ft_r \leq 0$. $f^0_v$ for $v\in\mathcal{V}$ is the initial fuel state of a car.

\paragraph{Ordering of the Trips} \parfill

We define the time, a vehicle needs to get from position $p_1$ to $p_2$ as $t_{p_1,p_2}$. We define
\begin{equation*}
	t_{s,t} = 
	\begin{cases}
		t_{\pend_s,\pstart_t} & \text{if } s,t\in\mathcal{T} \\
		t_{p_s,\pstart_t} & \text{if } s\in\mathcal{V}\cupdot\mathcal{R}, t\in\mathcal{T} \\
		t_{\pend_s,p_t} & \text{if } s\in\mathcal{T}, t\in\mathcal{R} \\
		t_{p_s,p_t} & \text{if } s\in\mathcal{V},t\in\mathcal{R}
	\end{cases}
\end{equation*}
as the time a vehicle needs from one trip to another.

In order to decide whether a vehicle is able to fulfill two trips in a row, we define a partial ordering on the set of vehicles and trips. The set of public transport trips is left out in this definition.

\begin{definition}[Order of trips]
\label{def:partial_order}

The binary relation $\prec$ on $\mathcal{V}\cupdot\mathcal{T}$ is defined as follows:
\begin{align*}
	s\prec t && :\Leftrightarrow && \left(\zend_s + t_{s,t} \leq \zstart_t\right)\land\left((M\circ C)(s)\neq (M\circ C)(t)\lor M(s)=M(t)\right) \\
	&&&& \text{for all } s\in\mathcal{V}\cupdot\mathcal{T}, t\in\mathcal{T} \hphantom{\mathcal{V}} \\
	s\not\prec t &&&& \text{for all } s\in\mathcal{V}\cupdot\mathcal{T}, t\in\mathcal{V} \hphantom{\mathcal{T}}
\end{align*}

The binary relation $\preceq$ on $\mathcal{V}\cupdot\mathcal{T}$ is defined as:
\begin{align*}
	s\preceq t && :\Leftrightarrow && s=t \land s\prec t && \text{for all } s,t\in\mathcal{V}\cupdot\mathcal{T}
\end{align*}

\end{definition}

The expression $s\prec t$ means, that one car is able to fulfill both trips, first $s$ and then $t$. A car must not cover two trips of the same costumer, except they belong to the same route. This results from the problem setting, that for each costumer exactly one route is fulfilled. 

\begin{remark}

Note, that $\preceq$ is not a partial order on $\mathcal{V}\cupdot\mathcal{T}$ since the transitivity is missing. Let $t_1,t_2,t_3\in\mathcal{T}$ with 
\begin{align*}
	\zend_{t_1} + t_{t_1,t_2} \leq \zstart_{t_2} && \zend_{t_2} + t_{t_2,t_3} \leq \zstart_{t_3}
\end{align*}
\begin{align*}
	(M\circ C)\left(t_1\right) = (M\circ C)\left(t_3\right) && (M\circ C)\left(t_1\right) \neq (M\circ C)\left(t_2\right) && M\left(t_1\right)\neq M\left(t_3\right)
\end{align*}

Then,
\begin{align*}
	t_1 \preceq t_2 \preceq t_3 && t_1 \not\preceq t_3
\end{align*}

\end{remark}

\paragraph{Problem Description} \parfill

We define the considered problem as follows: Find a schedule of trips for every vehicle including refueling stops and a sequence of trips for every costumer. Therefore, the car trips are fulfilled by the scheduled car and the public transport trips by public transport according to its timetable. For this, we have the following conditions:

\begin{itemize}
	\item{Each car is able to serve its scheduled trips, considering time and location.}
	\item{The fuel state of each car is always in a feasible range.}
	\item{Each costumer is able to complete his route, considering time and location.}
	\item{For each costumer, exactly one route is chosen.}
\end{itemize}

The goal is to find a cost-minimal feasible schedule considering all these constraints.

\paragraph{Costs} \parfill

We introduce the following types of costs:
\begin{itemize}
	\item{Vehicles costs $\cv$: unit costs for each used vehicle}
	\item{Deadhead costs $\cd_{s,t}$ for $s\in\mathcal{V}\cupdot\mathcal{T}\cupdot\mathcal{R}, t\in\mathcal{T}\cupdot\mathcal{R}$: costs, if a vehicle drives to a trip or a refuel station without a costumer using it}
	\item{Trip costs $\ct_t$ for $t\in\mathcal{T}$: costs for fulfilling a trip}
\end{itemize}

For public transport, we define either trip costs for each public transport trip or fixed costs for each costumer using public transport. Finally, we define costs to consider the costumer preferences.
\begin{itemize}
	\item{Trip costs $\ct_t$ for $t\in\mathcal{T}_{\operatorname{public}}$: costs for using public transport}
	\item{Route-dependent costs $\bar{c}^{\operatorname{r}}_m$ for $m\in\mathcal{M}$: costs for costumer preferences and unit costs for using public transport}
\end{itemize}

Since the trip costs for public transport are connected with the choice of the route, we easily add these costs to the trip costs.
\begin{align*}
	\croute_m := \bar{c}^{\operatorname{r}}_m + \sum_{t\in m\cap\Tpub}\ct_t && \text{for } m\in\mathcal{M}
\end{align*}

The route costs additionally include costumer preferences. Each costumer has a set of alternative routes. He does not choose the route by himself, but this is decided by the problem whatever fits best into the system. The user preference costs work as penalty terms for an inconvenient route choice. This means, a route that is disadvantageous for the costumer is penalized. Then, either the less favorable route is chosen (if it fits better into the system) and this is penalized. Or the more favorable route is chosen although it is not so good for the system. With this, a realistic costumer behavior is modeled.

The costumer preferences are \eg the total travel time, the number of changes or the costs for the costumer. Typically, a pure car trip is faster but more expensive. Further, a late departure time or an early arrival time can be criteria for this cost function.

\paragraph{Additional Assumptions} \parfill

In the following, we summarize all the assumptions we made on the input data.

All costs are non-negative.
\begin{align}
\label{eq:nonnegativ_cost}
	\cv\geq 0 && \cd_{s,t}\geq 0 && \ct_t\geq 0 && \bar{c}^{\operatorname{r}}_m\geq 0 && \text{for all } s,t\in\mathcal{T}, m\in\mathcal{M}.
\end{align}

The fuel consumption is non-negative, except for refueling.
\begin{align}
	& \ft_t\geq 0 && \ft_r\leq 0 && \text{for all } t\in\mathcal{T}, r\in\mathcal{R} \\
	& \fd_{s_1,s_2} \geq 0 &&&& \text{for all } s_1\in\mathcal{V}\cupdot\mathcal{T}\cupdot\mathcal{R},s_2\in\mathcal{T}\cupdot\mathcal{R}
\end{align}

There are no zero-time rentals.
\begin{align}
\label{eq:notime_trip}
	\zstart_t < \zend_t && \text{for all } t\in\mathcal{T}
\end{align}

We assume the Triangle Inequalities for $s\in\mathcal{V}\cupdot\mathcal{T}\cupdot\mathcal{R}$ and $r,t\in\mathcal{T}\cupdot\mathcal{R}$:
\begin{align}
\label{eq:triangle_inequality}
	t_{s,t} \leq t_{s,r} + t_{r,t} && \cd_{s,t} \leq \cd_{s,r} + \cd_{r,t} && \fd_{s,t} \leq \fd_{s,r} + \fd_{r,t}
\end{align}

From $\eqref{eq:nonnegativ_cost}$ and $\eqref{eq:triangle_inequality}$ we get:
\begin{align}
\label{eq:triangle_inequality_ext}
	\cd_{s,t} \leq \cd_{s,r} + \ct_{r} + \cd_{r,t} && \text{for all } s,r,t\in\mathcal{T}	
\end{align}

%----------------------------------------------------------------------------------------------------------------------------------------

\section{Classification}
\label{sec:classification}

We want to classify our problem in relation to other known problems in literature and state the difficulty of these problems.

\paragraph{Vehicle Scheduling Problems} \parfill

According to the structure of the problem stated in Section \ref{sec:problem_description}, we regard the field of vehicles scheduling problems (VSP). \cite{Bunte_Kliewer} define the (VSP) as follows: ``Given a set of timetabled trips with fixed travel (departure and arrival) times and start and end locations as well as traveling times between all pairs of end stations, the objective is to find an assignment of trips to vehicles such that each trip is covered exactly once, each vehicle performs a feasible sequence of trips and the overall costs are minimized.'' The complexity of some different variants of the (VSP) is regarded by \cite{Lenstra_Kan}.

A similar problem formulation is the dial-a-ride problem (DARP). \cite{Cordeau_Laporte} discuss the differences of the (DARP) to other vehicle routing problems and write: ``What makes the DARP different from most such routing problems is the human perspective. When transporting passengers, reducing user inconvenience must be balanced against minimizing operating costs.'' The basic formulations of (VSP) and (DARP) are the same, therefore we use the formulation (VSP).

\paragraph{Depot Variants} \parfill 

In \cite{Bunte_Kliewer}, there are two main variants for the (VSP) with respect to the fact where vehicles start and return. In the single depot case (SD-VSP), there is one depot from where all vehicles start. After usage, all vehicles return to this depot. The multiple depot case (MD-VSP) means that there is more than one depot and from each depot starts a certain number of vehicles. After usage, each vehicle returns to the depot from where it has started. 

In order to make our problem more realistic, we have more than one depot. We have more than one vehicle and each vehicle starts from its start position. The vehicles do not have a certain point, where there have to return after usage,  \ie they can stay, wherever the last trip of their duty ends. \cite{Daduna_Paixao} claim that ``if the vehicle[s] are allowed to return to a depot different from its origin depot, [...] the problem can be solved as a single depot instance.'' We see, that our problem is in the single depot case (SD-VSP) concerning the depot variant.

In \cite{Dantzig_Fulkerson} is proven that (SD-VSP) can be solved in polynomial time, \ie (SD-VSP) is in $\mathcal{P}$. In contrast, the multidepot case (MD-VSP) is $\mathcal{NP}$-hard as shown in \cite{Bertossi_Carraresi}.

\paragraph{Additional Constraints} \parfill

In the basic (SD-VSP), all existing trips have to be fulfilled. For more generality, there were additional cover constraints introduced in the underlying master theses. There are ``costumers with sets of alternative trips out of which exactly one trip shall be fulfilled, respectively.'' (\cite[p.10]{Kaiser_Knoll}) In our problem, even more general cover constraints are required. We have costumers with sets of alternative routes, consisting of trips; for each costumer, exactly one route has to be fulfilled, \ie each of its trips is fulfilled. We call these constraints ``multi-leg'' cover constraints and write the problem (VSP-MC). This is a generalization to the previous cover constraints, as can be seen easily by rewriting them: There are costumers with sets of alternative routes, where each route consists of exactly one trip. According to this reformulation, we call the primary constraints ``single-leg'' cover constraints and write the problem (VSP-SC). We see in Section \ref{sec:complexity} that (VSP-SC) is already $\mathcal{NP}$-hard.

We further have to respect the fuel constraints. In literature, there are named general resources like time, mileage or fuel, summarized in the general term ``route constraints'' (cf. \cite[p. 16]{Bunte_Kliewer}, \cite{Raff}). The respective problems with route constraints are called (SD-VSP-RC) and (MD-VSP-RC). \cite{Freling_Paixao} describe  the (VSP) with time constraints, \cite{Raff} presents the (VSP) with path constraints, what is a more general formulation. In these models, a vehicle returns to the depot after the respective resource is exhausted, while the vehicle has the possibility to refuel in our model. The problem with not refilling the resource is a special case of the problem with the possibility to refill the resource. We see in Section \ref{sec:complexity} that (SD-VSP-RC) is already $\mathcal{NP}$-hard.

In summary, we have a problem with two types of constraints where each individually makes the problem $\mathcal{NP}$-hard. The first one is the multi-leg cover constraint and the second one is the fuel constraint. The only difference to \cite{Kaiser_Knoll} is that the single-leg cover constraint is replaced by the multi-leg cover constraint. Their solution methods are extended to the requirements in this thesis. To the knowledge of the author, a combination of these constraints, as well as these constraints on their own, are not treated in literature so far.

%----------------------------------------------------------------------------------------------------------------------------------------

\section{Complexity}
\label{sec:complexity}

We regard the complexity of our problem. As we have seen in Section \ref{sec:classification}, the problem can be modeled as a single depot vehicle scheduling problem (SD-VSP) with resource constraints, the possibility of refueling and multi-leg cover constraints. The (SD-VSP) itself can be solved in polynomial time, which is proven by \cite{Dantzig_Fulkerson}. It can be formulated as minimum-cost flow problem. If we extend the basic formulation with one of the additional constraints, it gets $\mathcal{NP}$-hard.

\begin{theorem}[VSP with resource constraints]
\label{th:complexity_VSPRC}

The vehicle scheduling problem with resource constraints and the special objective of minimizing the number of used vehicles is $\mathcal{NP}$-hard.

\end{theorem}

This theorem is proven in \cite[p. 11]{Kaiser_Knoll} by a polynomial reduction of the bin packing problem. This theorem holds for the case of resource constraints without the possibility of refilling the resources. Since this is a special case of resource constraints with refueling, this problem is also $\mathcal{NP}$-hard. 

\begin{theorem}[VSP with cover constraints]
\label{th:complexity_VSPSC}

The vehicle scheduling problem with cover constraints and the special objective of minimizing the number of used vehicles is $\mathcal{NP}$-hard.

\end{theorem}

This theorem is proven in \cite[p. 12]{Kaiser_Knoll} by a polynomial reduction of the set cover problem. This theorem treats the case of single-leg cover constraints.

\begin{theorem}[VSP with multi-leg cover constraints]
\label{th:complexity_VSPMC}

The vehicle scheduling problem with multi-leg cover constraints and the special objective of minimizing the number of used vehicles is $\mathcal{NP}$-hard.

\end{theorem}

\begin{proof}

We prove this statement by a polynomial reduction of the (VSP-SC). Consider a (VSP-SC) with vehicles $\hat{\mathcal{V}}$, costumers $\hat{\mathcal{C}}$, trips $\hat{\mathcal{T}}$ and the function $\hat{C}:\hat{\mathcal{T}}\to\hat{\mathcal{C}}$ that maps trips to their respective costumers. The problem is defined in detail in \cite[pp. 5-8]{Kaiser_Knoll}. We create the corresponding (VSP-MC) as follows: $\mathcal{V}:=\hat{\mathcal{V}}$, $\mathcal{C}:=\hat{\mathcal{C}}$, $\mathcal{T}:=\hat{\mathcal{T}}$ stay the same. We define the multimodal routes as one-element sequence for each trip
\begin{align*}
	\mathcal{M}:=\left\{(t)\mid t\in\hat{\mathcal{T}}\right\}
\end{align*}
and the mappings
\begin{align*}
	M:\mathcal{T}\to\mathcal{M} \text{, } M(t) = (t), && C:\mathcal{M}\to\mathcal{C} \text{, } C(m) = \hat{C}(t) && \text{for } t\in m \text{ unique.}
\end{align*}

The solution of (VSP-SC) can easily be mapped to a solution of the corresponding (VSP-MC) and vice versa. If a trip is chosen in (VSP-SC), the respective route is chosen in (VSP-MC). Then, every trip of this route is fulfilled and the costumer is satisfied. The other way round, if a route is chosen in (VSP-MC), the trip contained in this route is chosen in (VSP-SC) and the costumer is satisfied. The feasibility of the vehicle duties is not affected by this procedure.

This is a polynomial reduction, (VSP-SC) is is $\mathcal{NP}$-hard by Theorem \ref{th:complexity_VSPSC} and hence (VSP-MC) is $\mathcal{NP}$-hard.

\end{proof}

With the Theorems \ref{th:complexity_VSPRC} and \ref{th:complexity_VSPMC} we can see, that our problem gets $\mathcal{NP}$-hard only with cover constraints or with resource constraints and considering the number of vehicles.

The problem gets even harder, as we do not only consider the number of vehicles but include the operational cost and penalty terms for costumer preferences. Further, we want to have the possibility to refuel during the process, \ie we have negative resource cost. Finally, we want to apply both of these constraints simultaneously. 

We will model our problem as a mixed-integer linear program in a size polynomial in the input size. Therefore, it is possible to verify a solution in polynomial time. This means, our problem is $\mathcal{NP}$-complete.